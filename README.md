# Web project example

Пример простого backend на django и frontend из HTML/CSS/JS для организации веб-приложения

## BackEnd на django
Собранный в данном примере django сервер во многом опирается и повторяет [статью](https://webdevblog.ru/sozdanie-django-api-ispolzuya-django-rest-framework-apiview/). 

Надо отметить, что в нашей версии включен механизм CORS для запросов от фронтенда. Грубо говоря это механизм защиты от принятия запросов с незнакомого frontend.
Этот механизм требует дополнительной установки модуля для django через pip:
`$ pip install django-cors-headers`

Также требуется внести изменения в файл settings.py: [Изменения можно посмотреть в этом коммите](https://gitlab.com/guimc/web-project-example/-/commit/52bef2a2a1e19fb6e80e5b5e5e1d8957ed8dd79d)

Стоит обратить внимание на то, что данные настройки разрешают запросы только через адрес localhost. Вы можете попробовать зайти на сайт по адресу
http://127.0.0.1/, сами страницы загрузятся (если настроен и запущен nginx сервер, о чём будет говориться ниже), но запросы в примере 2 работать не будут. В теории вы также можете в settings.py указать `CORS_ORIGIN_ALLOW_ALL = True`, что разрешит доступ для любого клиента, даже если html файл открыть просто на диске, однако такой подход не рекомендуется к использованию.

В целом про настройку CORS в django можно посмотреть [здесь](https://www.geeksforgeeks.org/how-to-enable-cors-headers-in-your-django-project/).
Учтите, что для демонстративной работы фронтенда нужно в базе создать хотя бы одного автора и парочку статей. Сделать это можно в админ-панели (см. статью по django выше).

## Настройка NGINX для FrontEnd
Как говорилось выше, в общем-то сами .html страницы можно открыть как обычные файлы и они даже смогут отобразиться как-то. Но вот запросы через fetch() вряд ли сработают, потому что:

1) Браузеры с подозрением относятся к так открытым страницам (с адресом `file:///C:/Users/himju/Documents/GitHub/web-project-example/frontend/index.html`, например) и могут запретить им делать fetch();
2) Сам наш бекенд не готов разрешить такие запросы (только если вы не указали `CORS_ORIGIN_ALLOW_ALL = True`).

Оптимальным вариантом решения этой проблемы является установка web-сервера для выдачи файлов фронтенда. Самых популярных и заслуженных представителей таких программ два: apache и nginx. 

Apache довольно тяжеловесен, но обладает большими возможностями для встройки модулей, в том числе обработчика PHP и других, требующих значительной вычислительной мощности.

NGINX же не расчитан на какие-либо вычисления, его задача - как можно быстрее отдать клиенту статический файл (готовый и не меняющийся, обычно к ним относятся .html, .js, .css, картинки и т.д.) или переслать запрос другому сервису, расчитанному на такие вычисления (например тому же django).
Вариант с nginx как раз для нас.

Устанавливать nginx на windows не требуется, достаточно [скачать](https://nginx.org/ru/download.html) архив и распокавать. Для старта сервера достаточно запустить внутри nginx.exe и этот сервер начнёт раздовать файлы из своей папки по умолчанию (/html).

Проверить его работоспособность можно зайдя на http://localhost/ в браузере или http://127.0.0.1/. Обратите внимание, что nginx всё равно, по какому адресу идёт обращение, но backend настроен на работу именно через localhost. 

Контроль за сервером можно осуществлять через командную строку. Для этого надо зайти в папку с nginx.exe и запустить эту программу с какой-либо командой (сигналом). Например, чтобы перезагрузить сервер, находящийся у меня в папке `c:/nginx`, требуется:
1) `c:` - переключение на работу с диском "C"
2) `cd c:/nginx` - переход в директорию nginx
3) `dir` - просмотр директории nginx, чтобы убедиться что nginx.exe здесь
4) `nginx.exe -h` - вывод справки по всем командам
5) `nginx.exe -s reload` - передача команды на перезагрузку

Однако, чтобы пример полностью зароботал, nginx нам надо ещё сконфигурировать. Происходит это в файле `nginx.conf` из папки `conf` nginx'а
1) Нужно указать другую директорию с файлами - [коммит](https://gitlab.com/guimc/web-project-example/-/commit/5f059857dc95f3969536e1b7a750b10acaac69d1) с изменениями
2) Дополнительно можно указать адрес для пересылки запросов на бэкенд, начинающихся с ключевого слова (например: /backend/) - [коммит](https://gitlab.com/guimc/web-project-example/-/commit/dadd48d539ced046e4f5193efd9fc6dd17171f1e)

Стоит отметить, что пересылка не является требованием для работы, а просто скрывает реальный адрес бэкенда (http://127.0.0.1:8000/... в нашем случае). Это хорошая практика для защиты от злоумышлинников и для распределения нагрузки (например бекэндов у крупных проектов несколько, и задачи обработки распросов распределяются между ними). В данных примерах frontend в любом случае в fetch() вписаны адреса точные (http://127.0.0.1:8000/...).
К тому же если с такой пересылкой обратиться к админ панели по адресу http://localhost/backend/admin/ вместо http://127.0.0.1:8000/admin, то файл стилей будет не найден и вся страница именно админ-панели разъедится.
